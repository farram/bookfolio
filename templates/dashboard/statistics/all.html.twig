{% extends 'dashboard.html.twig' %}
{% block title %}
	{{'Statistiques de visites  | Bookfolio' | trans }}
{% endblock %}
{% block body %}

	<div class="row g-5 g-xl-8">
		<div class="col-xl-3">
			{% if app.user.hasActiveSubscription %}
				<div class="card card-xl-stretch mb-xl-8">
					<div class="card-body d-flex flex-column p-0">
						<div class="d-flex flex-stack flex-grow-1 card-p">
							<div class="d-flex flex-column me-2">
								<span class="text-dark fw-bolder fs-3">{{"Aujourd'hui" | trans}}
									:
									{{ todayCount }}</span>
								<span class="text-muted fw-bold mt-1">
									{{"Hier" | trans}}
									:
									{{ yesterdayCount }}
								</span>
							</div>
							<span class="symbol symbol-50px">
								{% set count = todayCount - yesterdayCount %}
								{% set icon = null %}
								{% if count %}
									{% if todayCount > yesterdayCount %}
										<span class="symbol-label fs-5 fw-bolder bg-light-success text-success">
											{{ count }}
										</span>
									{% else %}
										<span class="symbol-label fs-5 fw-bolder bg-light-danger text-danger">
											{{ count }}
										</span>
									{% endif %}
								{% else %}
									<span class="symbol-label fs-5 fw-bolder bg-light-primary text-primary">
										+ 0%
									</span>
								{% endif %}
							</span>
						</div>
					</div>
				</div>
			{% else %}
				<div class="card card-xl-stretch mb-xl-8">
					<div class="card-body d-flex flex-column p-0">
						<div class="d-flex flex-stack flex-grow-1 card-p">
							<div class="d-flex flex-column me-2">
								<span class="text-dark fw-bolder fs-3">{{"Aujourd'hui" | trans}}</span>
								<span class="text-muted fw-bold mt-1">
									{{"Accès restreint" | trans}}
								</span>
							</div>
							<span class="symbol symbol-50px">
								<span class="svg-icon svg-icon-3tx svg-icon-danger mb-5">
									<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none">
										<rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="black"/>
										<path d="M15.8054 11.639C15.6757 11.5093 15.5184 11.4445 15.3331 11.4445H15.111V10.1111C15.111 9.25927 14.8055 8.52784 14.1944 7.91672C13.5833 7.30557 12.8519 7 12 7C11.148 7 10.4165 7.30557 9.80547 7.9167C9.19432 8.52784 8.88885 9.25924 8.88885 10.1111V11.4445H8.66665C8.48153 11.4445 8.32408 11.5093 8.19444 11.639C8.0648 11.7685 8 11.926 8 12.1112V16.1113C8 16.2964 8.06482 16.4539 8.19444 16.5835C8.32408 16.7131 8.48153 16.7779 8.66665 16.7779H15.3333C15.5185 16.7779 15.6759 16.7131 15.8056 16.5835C15.9351 16.4539 16 16.2964 16 16.1113V12.1112C16.0001 11.926 15.9351 11.7686 15.8054 11.639ZM13.7777 11.4445H10.2222V10.1111C10.2222 9.6204 10.3958 9.20138 10.7431 8.85421C11.0903 8.507 11.5093 8.33343 12 8.33343C12.4909 8.33343 12.9097 8.50697 13.257 8.85421C13.6041 9.20135 13.7777 9.6204 13.7777 10.1111V11.4445Z" fill="black"/>
									</svg>
								</span>
							</span>
						</div>
					</div>
				</div>
			{% endif %}
		</div>
		<div class="col-xl-3">
			{% if app.user.hasActiveSubscription %}
				<div class="card card-xl-stretch mb-xl-8">
					<div class="card-body d-flex flex-column p-0">
						<div class="d-flex flex-stack flex-grow-1 card-p">
							<div class="d-flex flex-column me-2">
								<span class="text-dark fw-bolder fs-3">{{"Ce mois" | trans}}
									:
									{{ thisMonthCount }}</span>
								<span class="text-muted fw-bold mt-1">
									{{"Le mois dernier" | trans}}
									:
									{{ lastMonthCount }}
								</span>
							</div>
							<span class="symbol symbol-50px">

								{% set count = thisMonthCount - lastMonthCount %}
								{% set icon = null %}
								{% if count %}
									{% if thisMonthCount > lastMonthCount %}
										<span class="symbol-label fs-5 fw-bolder bg-light-success text-success">
											{{ count }}
										</span>
									{% else %}
										<span class="symbol-label fs-5 fw-bolder bg-light-danger text-danger">
											{{ count }}
										</span>
									{% endif %}
								{% else %}
									<span class="symbol-label fs-5 fw-bolder bg-light-primary text-primary">
										+ 0%
									</span>
								{% endif %}
							</span>
						</div>
					</div>
				</div>
			{% else %}
				<div class="card card-xl-stretch mb-xl-8">
					<div class="card-body d-flex flex-column p-0">
						<div class="d-flex flex-stack flex-grow-1 card-p">
							<div class="d-flex flex-column me-2">
								<span class="text-dark fw-bolder fs-3">{{"Ce mois" | trans}}</span>
								<span class="text-muted fw-bold mt-1">
									{{"Accès restreint" | trans}}
								</span>
							</div>
							<span class="symbol symbol-50px">
								<span class="svg-icon svg-icon-3tx svg-icon-danger mb-5">
									<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none">
										<rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="black"/>
										<path d="M15.8054 11.639C15.6757 11.5093 15.5184 11.4445 15.3331 11.4445H15.111V10.1111C15.111 9.25927 14.8055 8.52784 14.1944 7.91672C13.5833 7.30557 12.8519 7 12 7C11.148 7 10.4165 7.30557 9.80547 7.9167C9.19432 8.52784 8.88885 9.25924 8.88885 10.1111V11.4445H8.66665C8.48153 11.4445 8.32408 11.5093 8.19444 11.639C8.0648 11.7685 8 11.926 8 12.1112V16.1113C8 16.2964 8.06482 16.4539 8.19444 16.5835C8.32408 16.7131 8.48153 16.7779 8.66665 16.7779H15.3333C15.5185 16.7779 15.6759 16.7131 15.8056 16.5835C15.9351 16.4539 16 16.2964 16 16.1113V12.1112C16.0001 11.926 15.9351 11.7686 15.8054 11.639ZM13.7777 11.4445H10.2222V10.1111C10.2222 9.6204 10.3958 9.20138 10.7431 8.85421C11.0903 8.507 11.5093 8.33343 12 8.33343C12.4909 8.33343 12.9097 8.50697 13.257 8.85421C13.6041 9.20135 13.7777 9.6204 13.7777 10.1111V11.4445Z" fill="black"/>
									</svg>
								</span>
							</span>
						</div>
					</div>
				</div>
			{% endif %}
		</div>
		<div class="col-xl-3">
			{% if app.user.hasActiveSubscription %}
				<div class="card card-xl-stretch mb-xl-8">
					<div class="card-body d-flex flex-column p-0">
						<div class="d-flex flex-stack flex-grow-1 card-p">
							<div class="d-flex flex-column me-2">
								<span class="text-dark fw-bolder fs-3">{{"Cette année" | trans}}
									:
									{{ thisYearCount }}</span>
								<span class="text-muted fw-bold mt-1">
									{{"L'année dernière" | trans}}
									:
									{{ lastYearCount }}
								</span>
							</div>
							<span class="symbol symbol-50px">

								{% set count = thisYearCount - lastYearCount %}
								{% set icon = null %}
								{% if count %}
									{% if thisYearCount > lastYearCount %}
										<span class="symbol-label fs-5 fw-bolder bg-light-success text-success">
											{{ count }}
										</span>
									{% else %}
										<span class="symbol-label fs-5 fw-bolder bg-light-danger text-danger">
											{{ count }}
										</span>
									{% endif %}
								{% else %}
									<span class="symbol-label fs-5 fw-bolder bg-light-primary text-primary">
										+ 0%
									</span>
								{% endif %}
							</span>
						</div>
					</div>
				</div>
			{% else %}
				<div class="card card-xl-stretch mb-xl-8">
					<div class="card-body d-flex flex-column p-0">
						<div class="d-flex flex-stack flex-grow-1 card-p">
							<div class="d-flex flex-column me-2">
								<span class="text-dark fw-bolder fs-3">{{"Cette année" | trans}}</span>
								<span class="text-muted fw-bold mt-1">
									{{"Accès restreint" | trans}}
								</span>
							</div>
							<span class="symbol symbol-50px">
								<span class="svg-icon svg-icon-3tx svg-icon-danger mb-5">
									<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none">
										<rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="black"/>
										<path d="M15.8054 11.639C15.6757 11.5093 15.5184 11.4445 15.3331 11.4445H15.111V10.1111C15.111 9.25927 14.8055 8.52784 14.1944 7.91672C13.5833 7.30557 12.8519 7 12 7C11.148 7 10.4165 7.30557 9.80547 7.9167C9.19432 8.52784 8.88885 9.25924 8.88885 10.1111V11.4445H8.66665C8.48153 11.4445 8.32408 11.5093 8.19444 11.639C8.0648 11.7685 8 11.926 8 12.1112V16.1113C8 16.2964 8.06482 16.4539 8.19444 16.5835C8.32408 16.7131 8.48153 16.7779 8.66665 16.7779H15.3333C15.5185 16.7779 15.6759 16.7131 15.8056 16.5835C15.9351 16.4539 16 16.2964 16 16.1113V12.1112C16.0001 11.926 15.9351 11.7686 15.8054 11.639ZM13.7777 11.4445H10.2222V10.1111C10.2222 9.6204 10.3958 9.20138 10.7431 8.85421C11.0903 8.507 11.5093 8.33343 12 8.33343C12.4909 8.33343 12.9097 8.50697 13.257 8.85421C13.6041 9.20135 13.7777 9.6204 13.7777 10.1111V11.4445Z" fill="black"/>
									</svg>
								</span>
							</span>
						</div>
					</div>
				</div>
			{% endif %}
		</div>
		<div class="col-xl-3">
			<div class="card card-xl-stretch mb-xl-8">
				<div class="card-body d-flex flex-column p-0">
					<div class="d-flex flex-stack flex-grow-1 card-p">
						<div class="d-flex flex-column me-2">
							<span class="text-dark fw-bolder fs-3">{{"Total des visites" | trans}}</span>
							<span class="text-muted fw-bold mt-1">
								{{"Depuis la création du book" | trans}}
							</span>
						</div>
						<span class="symbol symbol-50px">
							<span class="symbol-label fs-5 fw-bolder bg-light-primary text-primary">
								{{ app.user.getStatistics() | length }}
							</span>

						</span>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row g-5 g-xl-8">

		{% if app.user.hasActiveSubscription %}
			<div class="col-xl-6">
				<div class="card card-xl-stretch mb-xl-8">
					<div class="card-header border-0 pt-5">
						<h3 class="card-title align-items-start flex-column">
							<span class="card-label fw-bolder fs-3 mb-1">{{"Ce mois" | trans}}</span>
							<span class="text-muted fw-bold fs-7">
								{{"Depuis le"| trans}}
								{{ 'now'| date_modify('first day of this month') | format_date('full', locale='fr') }}
							</span>
						</h3>
					</div>
					<div class="card-body">
						{% if chartsThisMonthCount %}
							<div id="chartThisMonth"></div>
						{% else %}
							<div class="notice d-flex bg-light-warning rounded border-warning border border-dashed flex-shrink-0 p-6">
								<div class="d-flex flex-stack flex-grow-1 flex-wrap flex-md-nowrap">
									<div class="mb-3 mb-md-0 fw-bold">
										<div class="fs-6 text-gray-700 pe-7">{{"Aucune visite ce mois-ci pour l'instant. Revenez un peu plus tard ..." | trans}}</div>
									</div>
								</div>
							</div>
						{% endif %}

					</div>
				</div>
			</div>
			<div class="col-xl-6">
				<div class="card card-xl-stretch mb-5 mb-xl-8">
					<div class="card-header border-0 pt-5">
						<h3 class="card-title align-items-start flex-column">
							<span class="card-label fw-bolder fs-3 mb-1">{{"Cette année" | trans}}</span>
							<span class="text-muted fw-bold fs-7">{{"Classé par mois depuis le" | trans}}
								{{ 'now'| date_modify('first day of this year') | format_date('full', locale='fr') }}</span>
						</h3>
					</div>
					<div class="card-body">
						{% if chartsThisYearCount %}
							<div id="chartThisYear"></div>
						{% else %}
							<div class="notice d-flex bg-light-warning rounded border-warning border border-dashed flex-shrink-0 p-6">
								<div class="d-flex flex-stack flex-grow-1 flex-wrap flex-md-nowrap">
									<div class="mb-3 mb-md-0 fw-bold">
										<div class="fs-6 text-gray-700 pe-7">{{"Aucune visite cette année pour l'instant. Revenez un peu plus tard ..." | trans}}</div>
									</div>
								</div>
							</div>
						{% endif %}
					</div>
				</div>
			</div>
			<div class="col-xl-12">
				<div class="card card-xl-stretch mb-5 mb-xl-8">
					<div class="card-header border-0 pt-5">
						<h3 class="card-title align-items-start flex-column">
							<span class="card-label fw-bolder fs-3 mb-1">{{"L'année dernière" | trans}}</span>
							<span class="text-muted fw-bold fs-7">{{"Classé par mois depuis le" | trans}}
								{{ 'now'| date_modify('first day of last year') | format_date('full', locale='fr') }}
							</span>
						</h3>
					</div>
					<div class="card-body">
						{% if chartsLastYearCount %}
							<div id="chart_last_year" style="height: 350px"></div>
						{% else %}
							<div class="notice d-flex bg-light-warning rounded border-warning border border-dashed flex-shrink-0 p-6">
								<div class="d-flex flex-stack flex-grow-1 flex-wrap flex-md-nowrap">
									<div class="mb-3 mb-md-0 fw-bold">
										<div class="fs-6 text-gray-700 pe-7">{{"Aucune visite l'année dernière." | trans}}</div>
									</div>
								</div>
							</div>
						{% endif %}
					</div>
				</div>
			</div>
		{% else %}
			<div class="col-xl-12">
				<div class="notice d-flex bg-light-danger rounded border-danger border border-dashed d-flex flex-center flex-column py-10 px-10 px-lg-20 mb-10">
					<span class="svg-icon svg-icon-5tx svg-icon-danger mb-5">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none">
							<rect opacity="0.3" x="2" y="2" width="20" height="20" rx="10" fill="black"/>
							<rect x="11" y="17" width="7" height="2" rx="1" transform="rotate(-90 11 17)" fill="black"/>
							<rect x="11" y="9" width="2" height="2" rx="1" transform="rotate(-90 11 9)" fill="black"/>
						</svg>
					</span>
					<div class="text-center">
						<h1 class="fw-bolder mb-5">{{"Accès restreint"}}</h1>
						<div class="mb-9 text-dark">
							{{"Pour connaitre les visites du jour, du mois, de l'année en cours et de l'année dernière, vous devez disposer d'un compte Awesome ou Pro." | trans}}
						</div>
						<div class="d-flex flex-center flex-wrap">
							<button data-bs-toggle="modal" data-bs-target="#kt_modal_upgrade_plan" class="btn btn-danger m-2">{{"Consulter nos formules" | trans}}</button>
						</div>
					</div>
				</div>
			</div>
		{% endif %}
	</div>

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript">
		let chartsThisMonthCount = {{ chartsThisMonthCount | raw }};
let chartsThisMonthDate = {{ chartsThisMonthDate | raw }};
let chartsThisYearCount = {{ chartsThisYearCount }} ? {{ chartsThisYearCount | raw }} : null;
let chartsThisYearDate = {{ chartsThisYearDate | raw }};
let chartsLastYearCount = {{ chartsLastYearCount | raw }};
let chartsLastYearDate = {{ chartsLastYearDate | raw }};
	</script>
	<script src="{{ asset('assets/dashboard/js/custom/charts.js') }}"></script>
{% endblock %}
